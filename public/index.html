<!doctype html>
<html lang="zh-Hans">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>JavBus API</title>
    <style>
      body {
        margin: 0;
        display: flex;
        justify-content: center;
        color: #333333;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif,
          'Apple Color Emoji', 'Segoe UI Emoji';
      }

      p {
        margin: 8px 0;
      }

      a {
        text-decoration: none;
        color: #008cc4;
      }

      a:hover {
        text-decoration: underline;
      }

      .container {
        margin-top: 80px;
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      .title {
        margin: 0;
      }

      .login {
        display: none;
      }

      .login.show {
        display: flex;
      }

      .user {
        display: none;
        align-items: center;
      }

      .user.show {
        display: flex;
      }

      .username {
        margin-right: 8px;
      }

      .tip {
        padding: 0 32px;
      }

      .tip,
      .try {
        margin-top: 16px;
      }

      .list {
        margin: 8px 0 0 0;
        padding: 0 16px 0 32px;
      }

      .list li:not(:last-child) {
        margin-bottom: 8px;
      }

      .list li a {
        line-height: 24px;
      }

      .tag {
        background-color: #e6e6e6;
        display: inline-block;
        border-radius: 4px;
        padding: 0px 4px;
      }

      @media screen and (max-width: 375px) {
        .container {
          margin-top: 40px;
        }
      }
    </style>
  </head>

  <body>
    <div class="container">
      <h1 class="title">JavBus API</h1>
      <p class="login">
        <a href="/login.html">登录</a>
      </p>
      <p class="user">
        <span class="username"></span>
        <button class="logout">退出</button>
      </p>
      <p class="tip">如果你看到这个页面，说明服务已经成功运行起来！</p>
      <p>
        <a href="https://github.com/ovnrain/javbus-api#readme" target="_blank">查看文档</a>
      </p>
      <p class="try">你可以尝试访问以下 API：</p>
      <ol class="list">
        <li>
          <a href="/api/v1/movies?page=1&magnet=exist">返回有磁力链接的第一页影片</a>
        </li>
        <li>
          <a href="/api/v1/movies?page=1&filterType=star&filterValue=qs6&magnet=all">
            返回演员 ID 为
            <span class="tag">qs6</span>
            的影片的第一页，包含有磁力链接和无磁力链接的影片
          </a>
        </li>
        <li>
          <a href="/api/v1/movies/search?keyword=三上&page=1&magnet=exist">
            搜索关键词为
            <span class="tag">三上</span>
            的影片的第一页，只返回有磁力链接的影片
          </a>
        </li>
        <li>
          <p>影片详情</p>
          <ul class="list">
            <li><a href="/api/v1/movies/IPX-585">IPX-585</a></li>
            <li><a href="/api/v1/movies/IPZZ-023">IPZZ-023</a></li>
            <li><a href="/api/v1/movies/IPX-451">IPX-451</a></li>
          </ul>
        </li>
      </ol>
    </div>
    <script>
      const user = document.querySelector('.user');
      const username = document.querySelector('.username');
      const login = document.querySelector('.login');
      const logout = document.querySelector('.logout');

      fetch('/api/user')
        .then((res) => res.json())
        .then((res) => {
          if (res.username) {
            username.textContent = res.username;
            user.classList.add('show');
          } else if (res.useCredentials) {
            login.classList.add('show');
          }
        });

      logout.addEventListener('click', () => {
        fetch('/api/logout', {
          method: 'POST',
        }).then(() => {
          window.location.reload();
        });
      });
    </script>
  </body>
</html>
